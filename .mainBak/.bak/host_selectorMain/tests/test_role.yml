# SPDX-License-Identifier: MIT-0
# Author: jeleel-muibi | Updated: 2025-09-06
---
# Purpose: Smoke-test the host_selector role with interactive or automated environment input.

- name: Test Host Selector Role
  hosts: localhost
  gather_facts: false

  pre_tasks:
  - name: Prompt for environment (skip if already provided)
    pause:
      prompt: "Enter environment (e.g., staging, dev, prod):"
    register: env_input
    when: validated_env is not defined

  - name: Set validated_env
    set_fact:
      validated_env: "{{ env_input.user_input | lower | trim }}"
    when: validated_env is not defined

  roles:
  - role: ../../

  post_tasks:
  - name: Display selected hosts
    debug:
      msg: |
        Selected Hosts: {{ selected_hosts | default([]) }}
        Target Groups: {{ target_groups | default([]) }}

  - name: Verify host selection
    assert:
      that:
      - selected_hosts is defined
      - selected_hosts | length > 0
      - (groups['targets_to_ping'] | default([])) | length > 0
      - host_selector_success | default(false)
      success_msg: "Host selection successful: {{ selected_hosts | length }} hosts selected"
      fail_msg: "Host selection failed"
