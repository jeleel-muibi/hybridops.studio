---
# Enterprise Infrastructure Pipeline Test
# Author: jeleel-muibi | Updated: 2025-09-01 17:00:42 UTC

- name: Infrastructure Pipeline Test
  hosts: localhost
  gather_facts: true
  vars:
    env: "{{ target_env | default('') }}"

  roles:
  - role: common/env_guard
    tags: [ validation ]

  - role: common/gen_inventory
    vars:
      env: "{{ validated_env }}"
    when: env_guard_passed | default(false)
    tags: [ inventory ]

  - role: common/ip_mapper
    vars:
      target_environment: "{{ validated_env }}"
    when: env_guard_passed | default(false)
    tags: [ networking ]

  - role: common/connectivity_test
    vars:
      target_env: "{{ validated_env }}"
    when:
    - env_guard_passed | default(false)
    - not (skip_connectivity | default(false))
    tags: [ connectivity ]

  post_tasks:
  - name: Pipeline Summary
    debug:
      msg: |
        Pipeline Complete
        Environment: {{ validated_env | upper }}
        Risk Score: {{ env_guard_risk_score }}/10
        Status: {{ 'SUCCESS' if env_guard_passed else 'FAILED' }}
    when: env_guard_passed | default(false)
