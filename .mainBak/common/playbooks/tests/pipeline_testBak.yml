---
# Test All Environments with Consistent Naming
# Author: jeleel-muibi | Date: 2025-08-31 21:06:39 UTC

- name: Test All Environments (dev, staging, prod)
  hosts: localhost
  gather_facts: true

  tasks:
  - name: "🎯 Complete Environment Test Starting"
    debug:
      msg: |
        🎯 COMPLETE ENVIRONMENT TEST
        ├── Date: 2025-08-31 21:06:39 UTC
        ├── User: jeleel-muibi
        ├── Test: All environments with consistent naming
        └── Environments: dev, staging, prod

  - name: "🔄 Test all environments with consistent naming"
    include_tasks: test_single_env.yml
    vars:
      test_env: "{{ item }}"
    loop:
    - dev
    - staging
    - prod

  - name: "📊 Verify all inventory files"
    stat:
      path: "{{ ansible_env.PWD.split('/hybridops-studio')[0] }}/hybridops-studio/inventories/{{ item }}/hosts.ini"
    register: final_inventory_check
    loop:
    - dev
    - staging
    - prod

  - name: "📄 Show prod inventory content preview"
    slurp:
      src: "{{ ansible_env.PWD.split('/hybridops-studio')[0] }}/hybridops-studio/inventories/prod/hosts.ini"
    register: prod_inventory
    when: final_inventory_check.results[2].stat.exists

  - name: "🎉 Complete Test Results"
    debug:
      msg: |
        🎉 COMPLETE ENVIRONMENT TEST RESULTS
        ├── Project Root: {{ ansible_env.PWD.split('/hybridops-studio')[0] }}/hybridops-studio
        ├── DEV: {{ '✅ SUCCESS' if final_inventory_check.results[0].stat.exists else '❌ FAILED' }}
        ├── STAGING: {{ '✅ SUCCESS' if final_inventory_check.results[1].stat.exists else '❌ FAILED' }}
        ├── PROD: {{ '✅ SUCCESS' if final_inventory_check.results[2].stat.exists else '❌ FAILED' }}
        ├── Total Files: {{ final_inventory_check.results | selectattr('stat.exists') | list | length }}/3
        └── Status: {{ '🎉 ALL SUCCESS' if (final_inventory_check.results | selectattr('stat.exists') | list | length == 3) else '💥 SOME FAILED' }}

  - name: "📋 Prod Inventory Preview (first 30 lines)"
    debug:
      msg: "{{ (prod_inventory.content | b64decode).split('

        ')[:30] | join('

        ') }}"
    when: prod_inventory is defined and final_inventory_check.results[2].stat.exists
