---
# ==============================================================================
# Environment Guard Framework - Role Test (ipmapper)
# Tests IP Mapper role logic for a selected environment; validates mapping and CID logging.
# Author: Jeleel Muibi | Last Updated: 2025-09-10 22:25:00 UTC
# ==============================================================================
# SPDX-License-Identifier: MIT-0

- name: Test IP Mapper Role
  hosts: all
  connection: local # no remote connection while placeholders exist
  gather_facts: false

  vars_prompt:
  - name: validated_env
    prompt: "Enter validated environment (dev/staging/prod)"
    private: no
    default: dev

  vars:
    correlation_id: test-ip-mapper-001

  pre_tasks:
  - name: Normalize environment key
    set_fact:
      validated_env: "{{ validated_env | lower }}"

  - name: Validate environment choice
    assert:
      that:
      - validated_env in ['dev', 'staging', 'prod'] # expand if you add more in tests
      fail_msg: "Invalid environment '{{ validated_env }}'. Must be dev, staging, or prod."

  roles:
  - role: ../../ # from tests/ to role root; adjust if needed

  post_tasks:
  - name: Verify IP mapping
    assert:
      that:
      - ansible_host is defined
      - ansible_host != "XX.XX.XX.00"
      success_msg: "{{ inventory_hostname }} mapped to {{ ansible_host }}"
      fail_msg: "{{ inventory_hostname }} mapping failed"
